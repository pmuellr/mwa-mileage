
//-----------------------------------------------------------------------------
// Copyright (c) 2010 Patrick Mueller
// Licensed under the MIT license: 
// http://www.opensource.org/licenses/mit-license.php
//-----------------------------------------------------------------------------

require backbone

require ./FillUp

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
class FillUpLog < backbone.Collection
    super()
    
    _.bindAll(this)
    
    this.model = FillUp
    
    this.events = {
    
    }

    this.bind("change", function() { this.calculateAverageMileage() })
    this.bind("add",    function() { this.calculateAverageMileage() })
    this.bind("remove", function() { this.calculateAverageMileage() })

//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
getter averageMileage

    return this._averageMileage
    
//-----------------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
method calculateAverageMileage(fillUpLog)
    var memo = {miles: 0, gallons: 0}
    
    memo = fillUpLog.reduce(function(memo,fillUp) {
        memo.miles   += fillUp.miles
        memo.gallons += fillUp.gallons
        return memo
    }, memo)
    
    if ((memo.miles == 0) || (memo.gallons == 0)) {
        fillUpLog._averageMileage = 0
    }
    else {
        fillUpLog._averageMileage = memo.miles * 1.0 / memo.gallons
    }

    